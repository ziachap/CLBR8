{% extends "App/base.html" %}
{% load staticfiles %}
{% block title %}{% for participant in c_conversation.participants.all %}{{ participant.profile.artist_name }}, {% endfor %}{% endblock %}

{%  block head %}
    <script>

    </script>
{% endblock %}

{% block content %}

    <div class="blank_page_content" xmlns="http://www.w3.org/1999/html">
        <br />
        <!-- CONVO BEGIN -->
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

                <!-- PROFILE HEADER -->
                <div class="row">

                    <div class="col-md-12">

                        <h2>
                            {% for participant in c_conversation.participants.all %}
                                <img class="img-circle" src="{{ participant.profile.profile_pic.thumbnail.url }}" width="50px" /> {{ participant.profile.artist_name }},
                            {% endfor %}
                            <br />
                        </h2>
                        <a href="{% url 'inbox' %}"><i class="fa fa-chevron-circle-left"></i> Back to inbox</a>

                        <!--<small>
                            Conversation
                        </small>-->
                    </div>

                </div>
                <hr>

                <!-- MESSAGES -->
                {% if c_messages %}
                <div class="row">
                    <div class="col-md-12">
                        <h3><i class="fa fa-envelope"></i> Messages ({{ c_conversation.message_set.count }})</h3>
                    </div>
                </div>
                <div class="row">
                    <div id="message-window-id" class="col-md-12 message-window">
                        {% for message in c_messages %}
                        <div class="round_outline">
                            <div class="row">
                                <div class="col-md-1">
                                    <a href="/profile/{{ message.sender.user.username }}/"><img class="img-rounded custom-img-rounded" src="{{ message.sender.profile_pic.thumbnail.url }}" width="50px" /></a>
                                </div>
                                <div class="col-md-11">
                                    <h4><a href="/profile/{{ message.sender.user.username }}/"> {{ message.sender.artist_name }}</a> - <i class="fa fa-time"></i> <small>{{ message.date_created }}</small></h4>
                                    {{ message.content }}
                                </div>
                            </div>
                        </div>
                        <br />
                        {% endfor %}
                    </div>
                </div><br />
                {% endif %}

                <!-- MESSAGE REPLY FORM -->
                <form id="new_message_form" method="post" action="/conversation/{{ c_conversation.id }}/" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-10">
                            {{ form.content.errors }}
                            <div class="input-group margin-bottom-sm">
                            <span class="input-group-addon"><i class="fa fa-align-left fa-fw"></i></span>
                            <textarea class="form-control" type="textarea" rows="5" name="content" placeholder="Type your message here">{{ form.content.value|default_if_none:"" }}</textarea>
                            </div><br />
                        </div>
                        <div class="col-md-2">
                            <CENTER><input class="btn btn-default btn-lg" type="submit" value="Send" /></CENTER>
                        </div>
                    </div>
                </form>

            </div>
        </div>
        <!-- CONVO END -->
    </div>
{% endblock %}

{% block scripts %}
    <script src="{% static 'packery/packery.pkgd.min.js' %}"></script>
    <script src="{% static 'draggability/draggabilly.pkgd.min.js' %}"></script>
    <script>
        // PACKERY ------------
        var $container = $('#container').packery({
          columnWidth: 70,
          rowHeight: 65
        });
        $container.find('.item').each( function( i, itemElem ) {
          // make element draggable with Draggabilly
          var draggie = new Draggabilly( itemElem );
          // bind Draggabilly events to Packery
          $container.packery( 'bindDraggabillyEvents', draggie );
        });
        $(window).load(function() {
            $container.packery({
              itemSelector: '.item',
              gutter: 5
            });
            // Scroll to bottom of mesage window
            $("#message-window-id").animate({ scrollTop: $('#message-window-id')[0].scrollHeight}, 500);
        });
    </script>
    <link href="{% static 'css/listing_packery.css' %}" rel="stylesheet">
    <style type="text/css">
        .item:hover { background-color: #FBFBFB; }
        .item { width: 70px; }
    </style>
{% endblock %}